<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI SaaS Live Ready</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500&display=swap">
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>

<style>
:root {--bg:#131314;--sidebar:#1e1f20;--text:#e3e3e3;--blue:#8ab4f8;--hover:#333537;}
*{box-sizing:border-box;margin:0;padding:0;font-family:'Google Sans',sans-serif;}
body{background:var(--bg);color:var(--text);display:flex;height:100vh;overflow:hidden;}
#side-nav{width:280px;background:var(--sidebar);height:100%;flex-direction:column;display:flex;padding:15px;transition:0.3s;}
#side-nav.collapsed{width:0;padding:0;margin-left:-280px;}
.btn-new-chat{background:#1a1a1c;border-radius:50px;padding:14px 20px;display:flex;align-items:center;gap:15px;cursor:pointer;color:#8e918f;border:1px solid #333;}
.btn-new-chat:hover{background:var(--hover);}
.chat-history{flex:1;margin-top:25px;overflow-y:auto;}
.history-item{padding:10px 15px;border-radius:50px;font-size:14px;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:flex;align-items:center;gap:10px;}
.history-item:hover{background:var(--hover);}
.main-view{flex:1;display:flex;flex-direction:column;position:relative;}
header{padding:12px 20px;display:flex;align-items:center;justify-content:space-between;}
.logo-box{display:flex;align-items:center;gap:8px;font-size:18px;font-weight:500;}
.auth-btn{background:var(--blue);color:#004a77;padding:8px 24px;border-radius:50px;font-weight:500;cursor:pointer;border:none;font-size:14px;}
.user-pfp{width:34px;height:34px;border-radius:50%;cursor:pointer;display:none;border:1px solid #444;}
#chat-area{flex:1;overflow-y:auto;padding:40px 15%;display:flex;flex-direction:column;gap:25px;scroll-behavior:smooth;}
.msg-row{display:flex;gap:20px;font-size:16px;line-height:1.7;animation:slideUp 0.3s ease;}
.msg-row.user{flex-direction:row-reverse;}
@keyframes slideUp{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
.avatar-circle{width:32px;height:32px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;overflow:hidden;}
.content-box{max-width:85%;}
.cursor{display:inline-block;width:8px;height:18px;background:#fff;margin-left:5px;animation:blink 0.8s infinite;vertical-align:middle;}
@keyframes blink{50%{opacity:0;}}
.input-console{position:absolute;bottom:35px;left:50%;transform:translateX(-50%);width:70%;max-width:850px;background:#1e1f20;border-radius:32px;padding:12px 25px;display:flex;align-items:center;gap:15px;box-shadow:0 8px 32px rgba(0,0,0,0.3);border:1px solid #333;}
#user-prompt{flex:1;background:none;border:none;color:#fff;font-size:16px;outline:none;resize:none;max-height:200px;}
.console-icons{display:flex;gap:20px;color:#c4c7c5;font-size:22px;cursor:pointer;}
.mic-active{color:var(--blue);animation:pulse 1s infinite;}
@keyframes pulse{0%{opacity:1;}50%{opacity:0.5;}100%{opacity:1;}}
#admin-panel{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(20,20,20,0.95);color:#fff;display:none;flex-direction:column;align-items:center;padding:20px;overflow-y:auto;}
.admin-input{margin:10px 0;padding:10px;border-radius:8px;border:none;width:300px;max-width:80%;background:#2a2a2a;color:#fff;}
.admin-btn{padding:8px 20px;margin:10px;background:var(--blue);border:none;border-radius:50px;color:#004a77;font-weight:500;cursor:pointer;}
.password-toggle{position:relative;}
.password-toggle span{position:absolute;right:10px;top:10px;cursor:pointer;}
@media(max-width:768px){.input-console{width:92%;bottom:20px;}#chat-area{padding:20px 10px 150px;}}
</style>
</head>
<body>

<div id="side-nav">
  <div class="btn-new-chat" onclick="location.reload()">Ôºã New chat</div>
  <div class="chat-history" id="history-list"><div id="guest-info" style="padding:15px;font-size:12px;color:#888;">Log in to keep your chat history.</div></div>
  <div style="padding:10px;font-size:11px;color:#555;border-top:1px solid #333;text-align:center;">Killer King Edition</div>
</div>

<div class="main-view">
<header>
<div style="display:flex;align-items:center;gap:15px;">
<div style="font-size:24px;cursor:pointer;padding:5px;" onclick="document.getElementById('side-nav').classList.toggle('collapsed')">‚ò∞</div>
<div class="logo-box">AI SaaS</div>
</div>
<div id="auth-box">
<button class="auth-btn" onclick="signIn()">Sign in</button>
<img src="" id="pfp-img" class="user-pfp" onclick="signOutUser()">
</div>
</header>

<div id="chat-area">
<div id="welcome-msg" style="margin-top:100px;">
<h1 style="font-size:42px;font-weight:400;color:#444746;">Hello, <span id="user-name-tag">Guest</span></h1>
<p style="font-size:24px;color:#444746;">I'm your AI assistant. How can I help?</p>
</div>
</div>

<div class="input-console">
<textarea id="user-prompt" placeholder="Enter a prompt here" rows="1" oninput="this.style.height='auto';this.style.height=this.scrollHeight+'px'"></textarea>
<div class="console-icons">
<div id="mic-icon" onclick="startVoice()">üéôÔ∏è</div>
<div onclick="executeAI()" style="color:var(--blue)">‚û§</div>
<div onclick="toggleAdminPanel()" title="Admin Panel">‚öôÔ∏è</div>
</div>
</div>
</div>

<div id="admin-panel">
<h2>Admin Panel</h2>
<div>
<input class="admin-input" id="admin-email" placeholder="Admin Email">
<button class="admin-btn" onclick="saveAdminEmail()">Update Admin Email</button>
</div>
<div>
<input class="admin-input" id="api-key" placeholder="AI API Key">
<input class="admin-input" id="api-endpoint" placeholder="AI Endpoint">
<button class="admin-btn" onclick="saveAIConfig()">Save AI Config</button>
</div>
<button class="admin-btn" onclick="toggleAdminPanel()">Close Admin Panel</button>
</div>

<script>
  // Firebase config (from old website)
  const firebaseConfig = {
    apiKey: "AIzaSyA0R7a03Habu9c-fRnlJgXRtOkUUBRXBYk",
    authDomain: "myaicoder-6ce7a.firebaseapp.com",
    projectId: "myaicoder-6ce7a",
    storageBucket: "myaicoder-6ce7a.firebasestorage.app",
    messagingSenderId: "1035663178472",
    appId: "1:1035663178472:web:3b6f72e4cc6e2a48c2275d"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  let activeUser = null;
  let adminEmail = "saabj5614@gmail.com";

  function signIn(){ auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
  function signOutUser(){ if(confirm("Logout?")) auth.signOut().then(()=>location.reload()); }

  auth.onAuthStateChanged(user=>{
    if(user){
      activeUser = user;
      document.querySelector('.auth-btn').style.display='none';
      const pfp=document.getElementById('pfp-img');
      pfp.src=user.photoURL; pfp.style.display='block';
      document.getElementById('user-name-tag').innerText=user.displayName.split(' ')[0];
      document.getElementById('guest-info').style.display='none';
      loadHistory();
    }
  });

  async function executeAI(){
    const field=document.getElementById('user-prompt'); const query=field.value.trim();
    if(!query) return; document.getElementById('welcome-msg').style.display='none';
    addBubble('user',query); field.value=""; field.style.height="auto";

    const doc=await db.collection("settings").doc("ai_config").get();
    if(!doc.exists||!doc.data().apiKey){ addBubble('ai','AI not configured yet!'); return; }
    const {apiKey,endpoint}=doc.data();
    try{
      const res=await fetch(`${endpoint}?key=${apiKey}`,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({contents:[{parts:[{text:query}]}]})
      });
      const data=await res.json();
      const aiRes=data.candidates[0].content.parts[0].text;
      addBubble('ai',aiRes);
      if(activeUser){
        db.collection("full_gemini_chats").add({uid:activeUser.uid,prompt:query,res:aiRes,time:firebase.firestore.FieldValue.serverTimestamp()});
      }
    }catch(e){ addBubble('ai','AI error. Please retry.'); }
  }

  function addBubble(role,text){
    const area=document.getElementById('chat-area'); const row=document.createElement('div'); row.className=`msg-row ${role}`;
    const icon=role==='user'?`<img src="${activeUser?activeUser.photoURL:'https://cdn-icons-png.flaticon.com/512/149/149071.png'}" style="width:100%">`:`<img src="https://www.gstatic.com/lamda/images/gemini_sparkle_v002_d4735304ef622916b.svg" style="width:24px">`;
    row.innerHTML=`<div class="avatar-circle">${icon}</div><div class="content-box"><div class="text-payload"></div></div>`;
    area.appendChild(row);
    const payload=row.querySelector('.text-payload');
    if(role==='ai'){let i=0; const speed=5; const timer=setInterval(()=>{if(i<text.length){payload.innerHTML=text.substring(0,i+1)+'<span class="cursor"></span>'; i++; area.scrollTop=area.scrollHeight;}else{payload.innerHTML=text; clearInterval(timer);}},speed);}
    else{payload.innerText=text;}
    area.scrollTop=area.scrollHeight;
  }

  function loadHistory(){
    if(!activeUser) return;
    db.collection("full_gemini_chats").where("uid","==",activeUser.uid).orderBy("time","desc").limit(10).onSnapshot(s=>{
      const list=document.getElementById('history-list'); list.innerHTML="";
      s.forEach(doc=>{const d=doc.data(); const el=document.createElement('div'); el.className='history-item';
        el.innerHTML=`<span>üí¨</span> ${d.prompt}`; el.onclick=()=>{document.getElementById('welcome-msg').style.display='none'; addBubble('user',d.prompt); addBubble('ai',d.res);}
        list.appendChild(el);
      });
    });
  }

  function startVoice(){const rec=new (window.SpeechRecognition||window.webkitSpeechRecognition)(); const mic=document.getElementById('mic-icon'); rec.lang='en-US'; rec.start(); mic.classList.add('mic-active'); rec.onresult=(e)=>{mic.classList.remove('mic-active'); document.getElementById('user-prompt').value=e.results[0][0].transcript; executeAI();}; rec.onerror=()=>mic.classList.remove('mic-active');}

  function toggleAdminPanel(){if(activeUser && activeUser.email===adminEmail){const panel=document.getElementById('admin-panel'); panel.style.display=panel.style.display==='flex'?'none':'flex'; document.getElementById('admin-email').value=adminEmail;} else alert("Access Denied");}

  function saveAIConfig(){const key=document.getElementById('api-key').value; const ep=document.getElementById('api-endpoint').value; db.collection("settings").doc("ai_config").set({apiKey:key,endpoint:ep}).then(()=>alert("AI config updated!"));}

  function saveAdminEmail(){const newEmail=document.getElementById('admin-email').value; adminEmail=newEmail; db.collection("settings").doc("admin_config").set({email:newEmail}).then(()=>alert("Admin email updated!"));}
</script>

</body>
    </html>

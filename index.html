<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KILLER KING AI - PREMIER</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Roboto+Mono&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #1a73e8;
            --sidebar-bg: #f8f9fa;
            --chat-bg: #ffffff;
            --input-bg: #f1f3f4;
            --text-main: #202124;
            --shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Google Sans', sans-serif; background: var(--chat-bg); color: var(--text-main); height: 100vh; display: flex; overflow: hidden; }

        /* --- 1. ENHANCED CENTER LOADER --- */
        #loader {
            position: fixed; inset: 0; background: #fff; z-index: 10000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .loader-content { text-align: center; }
        .loader-logo { font-size: 60px; font-weight: 700; background: linear-gradient(to right, #1a73e8, #d93025, #f4b400, #34a853); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 10px; }
        .progress-bar { width: 200px; height: 4px; background: #eee; border-radius: 10px; overflow: hidden; margin-top: 20px; }
        .progress-fill { width: 0%; height: 100%; background: var(--primary); animation: load 2s forwards; }
        @keyframes load { to { width: 100%; } }

        /* --- 2. PRO LOGIN SCREEN --- */
        #login-overlay {
            position: fixed; inset: 0; background: #fff; z-index: 9000;
            display: none; flex-direction: column; align-items: center; justify-content: center;
        }
        .login-box { background: #fff; padding: 40px; border-radius: 12px; border: 1px solid #ddd; width: 100%; max-width: 450px; box-shadow: var(--shadow); }
        .login-box h2 { margin-bottom: 25px; text-align: center; font-weight: 400; }
        .field { margin-bottom: 15px; }
        .field input { width: 100%; padding: 15px; border: 1px solid #ccc; border-radius: 8px; font-size: 16px; outline: none; }
        .field input:focus { border-color: var(--primary); }
        .btn { width: 100%; padding: 15px; border-radius: 8px; border: none; font-size: 16px; font-weight: 500; cursor: pointer; transition: 0.2s; }
        .btn-main { background: var(--primary); color: #fff; margin-bottom: 10px; }
        .btn-google { background: #fff; border: 1px solid #dadce0; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-google:hover { background: #f7f8f8; }

        /* --- 3. DYNAMIC SIDEBAR --- */
        #sidebar { width: 300px; background: var(--sidebar-bg); display: flex; flex-direction: column; padding: 20px; border-right: 1px solid #dadce0; transition: 0.3s; }
        .new-chat-trigger { background: #e8f0fe; color: #1967d2; padding: 15px; border-radius: 12px; text-align: center; cursor: pointer; font-weight: 500; margin-bottom: 25px; border: 1px solid #c2e7ff; }
        .history-container { flex: 1; overflow-y: auto; }
        .history-card { padding: 12px; border-radius: 8px; cursor: pointer; margin-bottom: 8px; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; border: 1px solid transparent; }
        .history-card:hover { background: #eef1f4; border-color: #ddd; }

        /* --- 4. MAIN WORKSPACE --- */
        .main-view { flex: 1; display: flex; flex-direction: column; position: relative; background: #fff; }
        header { padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #f1f1f1; }
        .user-ctrl { display: flex; align-items: center; gap: 15px; }
        .p-img { width: 38px; height: 38px; border-radius: 50%; border: 2px solid #1a73e8; cursor: pointer; }

        #chat-stream { flex: 1; overflow-y: auto; padding: 40px 20px; display: none; width: 100%; max-width: 900px; margin: 0 auto; }
        .intro-section { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        .intro-title { font-size: 48px; font-weight: 500; margin-bottom: 15px; background: linear-gradient(to right, #4285f4, #ea4335, #fbbc05); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        /* --- 5. ENHANCED INPUT AREA --- */
        .input-anchor { width: 100%; max-width: 900px; margin: 0 auto; padding: 20px; position: relative; }
        #image-preview-wrapper { display: none; position: absolute; bottom: 100px; left: 20px; background: #fff; padding: 10px; border-radius: 12px; box-shadow: var(--shadow); border: 1px solid #eee; }
        .preview-img { max-width: 150px; max-height: 150px; border-radius: 8px; }
        
        .interaction-bar { background: var(--input-bg); border-radius: 30px; display: flex; align-items: center; padding: 10px 25px; gap: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); }
        #user-input-field { flex: 1; background: transparent; border: none; outline: none; font-size: 16px; padding: 10px 0; }
        .action-icon { cursor: pointer; font-size: 22px; color: #5f6368; padding: 8px; border-radius: 50%; transition: 0.2s; }
        .action-icon:hover { background: #e4e6e9; color: #202124; }

        /* --- CHAT BUBBLES --- */
        .bubble { margin-bottom: 40px; animation: fadeIn 0.4s; }
        .bubble.user { font-weight: 500; color: #202124; }
        .bubble.ai { color: #3c4043; line-height: 1.8; }
        .code-container { background: #202124; color: #f1f1f1; padding: 20px; border-radius: 12px; font-family: 'Roboto Mono', monospace; margin-top: 15px; overflow-x: auto; border-left: 5px solid #1a73e8; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="loader">
        <div class="loader-content">
            <div class="loader-logo">KILLER KING</div>
            <p style="color: #5f6368; font-weight: 500;">Initializing Advanced AI Engine...</p>
            <div class="progress-bar"><div class="progress-fill"></div></div>
        </div>
    </div>

    <div id="login-overlay">
        <div class="login-box">
            <h2>Killer King Login</h2>
            <div class="field"><input type="email" id="auth-email" placeholder="Email"></div>
            <div class="field"><input type="password" id="auth-pass" placeholder="Password"></div>
            <button class="btn btn-main" onclick="handleEmailLogin()">Sign In / Register</button>
            <div style="text-align:center; margin: 15px 0; color:#888;">OR</div>
            <button class="btn btn-google" onclick="handleGoogleLogin()">
                <img src="https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_Logo.svg" width="18">
                Continue with Google
            </button>
        </div>
    </div>

    <div id="sidebar">
        <div class="new-chat-trigger" onclick="resetApp()">+ New Conversation</div>
        <p style="font-size: 11px; color: #70757a; font-weight: 700; margin-bottom: 10px; letter-spacing: 1px;">HISTORY</p>
        <div class="history-container" id="history-box"></div>
        <div id="user-info" style="font-size: 12px; color: #5f6368; border-top: 1px solid #ddd; padding-top: 15px;"></div>
    </div>

    <div class="main-view">
        <header>
            <div style="font-size: 22px; font-weight: 700; color: #1a73e8;">Killer King AI</div>
            <div class="user-ctrl">
                <img src="" id="top-pfp" class="p-img" onclick="userExit()">
            </div>
        </header>

        <div id="intro-view" class="intro-section">
            <h1 class="intro-title">Hello, Boss</h1>
            <h2 style="font-size: 40px; color: #bdc1c6; font-weight: 400;">Ready to conquer your tasks?</h2>
        </div>

        <div id="chat-stream"></div>

        <div class="input-anchor">
            <div id="image-preview-wrapper">
                <img src="" id="image-tag" class="preview-img">
                <div onclick="removeImage()" style="position:absolute; top:-10px; right:-10px; background:#d93025; color:white; border-radius:50%; width:24px; height:24px; text-align:center; cursor:pointer; line-height:24px;">√ó</div>
            </div>
            
            <div class="interaction-bar">
                <label class="action-icon" title="Upload Image/Screenshot">
                    üì∑ <input type="file" id="media-input" hidden accept="image/*" onchange="processImage(event)">
                </label>
                <input type="text" id="user-input-field" placeholder="Message Killer King AI..." onkeypress="if(event.key==='Enter') triggerAI()">
                <div class="action-icon" id="mic-trigger">üéôÔ∏è</div>
                <div class="action-icon" onclick="triggerAI()" style="color:#1a73e8;">‚û§</div>
            </div>
            <p style="text-align:center; font-size:11px; color:#888; margin-top:10px;">Powered by Gemini 1.5 Pro Engine ‚Ä¢ Official Killer King Build</p>
        </div>
    </div>

    <script>
        // --- FIREBASE CORE ---
        const firebaseConfig = {
            apiKey: "AIzaSyA0R7a03Habu9c-fRnlJgXRtOkUUBRXBYk",
            authDomain: "myaicoder-6ce7a.firebaseapp.com",
            projectId: "myaicoder-6ce7a",
            storageBucket: "myaicoder-6ce7a.firebasestorage.app",
            messagingSenderId: "1035663178472",
            appId: "1:1035663178472:web:3b6f72e4cc6e2a48c2275d"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const API_KEY = "AIzaSyDYiYnfekx-lGzSIglPNBsQZjs72nrJ5vk";

        let sessionUser = null;
        let pendingBase64 = "";

        // --- AUTH SYSTEMS ---
        function handleGoogleLogin() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
        function handleEmailLogin() {
            const e = document.getElementById('auth-email').value;
            const p = document.getElementById('auth-pass').value;
            auth.signInWithEmailAndPassword(e, p).catch(() => auth.createUserWithEmailAndPassword(e, p));
        }
        function userExit() { if(confirm("Logout from Killer King?")) auth.signOut().then(() => location.reload()); }
        function resetApp() { location.reload(); }

        auth.onAuthStateChanged(user => {
            if(user) {
                sessionUser = user;
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('top-pfp').src = user.photoURL || 'https://www.pngall.com/wp-content/uploads/5/User-Profile-PNG.png';
                document.getElementById('user-info').innerText = "Active User: " + (user.displayName || user.email);
                syncHistory();
            } else {
                document.getElementById('login-overlay').style.display = 'flex';
            }
            setTimeout(() => document.getElementById('loader').style.display = 'none', 2000);
        });

        // --- MULTIMEDIA ---
        function processImage(e) {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = () => {
                pendingBase64 = reader.result.split(',')[1];
                document.getElementById('image-tag').src = reader.result;
                document.getElementById('image-preview-wrapper').style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
        function removeImage() { pendingBase64 = ""; document.getElementById('image-preview-wrapper').style.display = 'none'; }

        // --- VOICE ---
        const speech = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        speech.lang = 'hi-IN';
        document.getElementById('mic-trigger').onclick = () => {
            speech.start();
            document.getElementById('user-input-field').placeholder = "Listening to Boss...";
        };
        speech.onresult = (e) => {
            document.getElementById('user-input-field').value = e.results[0][0].transcript;
            triggerAI();
        };

        // --- AI CORE ---
        async function triggerAI() {
            const prompt = document.getElementById('user-input-field').value;
            if(!prompt && !pendingBase64) return;

            document.getElementById('intro-view').style.display = 'none';
            document.getElementById('chat-stream').style.display = 'block';

            const stream = document.getElementById('chat-stream');
            let userMarkup = `<div class="bubble user"><strong>You</strong><br>${prompt}`;
            if(pendingBase64) userMarkup += `<br><img src="data:image/jpeg;base64,${pendingBase64}" style="max-width:300px; border-radius:12px; margin-top:15px; box-shadow:0 4px 10px rgba(0,0,0,0.1);">`;
            userMarkup += `</div>`;
            stream.innerHTML += userMarkup;

            const currentP = prompt; const currentI = pendingBase64;
            document.getElementById('user-input-field').value = "";
            document.getElementById('user-input-field').placeholder = "Message Killer King AI...";
            removeImage();
            stream.scrollTop = stream.scrollHeight;

            try {
                const parts = [{ text: currentP || "Analyze this image in detail." }];
                if(currentI) parts.push({ inline_data: { mime_type: "image/jpeg", data: currentI } });

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts }] })
                });

                const data = await response.json();
                let aiText = data.candidates[0].content.parts[0].text;
                
                // Formatter for code blocks
                if(aiText.includes("```")) {
                    aiText = aiText.replace(/```([\s\S]*?)```/g, '<div class="code-container">$1</div>');
                }
                
                stream.innerHTML += `<div class="bubble ai"><strong>Killer King</strong><br>${aiText.replace(/\n/g, '<br>')}</div>`;
                stream.scrollTop = stream.scrollHeight;

                db.collection("killer_pro_history").add({
                    uid: sessionUser.uid,
                    prompt: currentP || "Visual Query",
                    reply: aiText,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
            } catch (err) {
                stream.innerHTML += `<div class="bubble ai" style="color:red;">Error: AI Engine Offline. Check API Connectivity.</div>`;
            }
        }

        // --- HISTORY SYNC ---
        function syncHistory() {
            db.collection("killer_pro_history").where("uid", "==", sessionUser.uid).orderBy("timestamp", "desc").limit(20).onSnapshot(snap => {
                const box = document.getElementById('history-box');
                box.innerHTML = "";
                snap.forEach(doc => {
                    const d = doc.data();
                    const card = document.createElement('div');
                    card.className = 'history-card';
                    card.innerText = "üí¨ " + d.prompt;
                    card.onclick = () => {
                        document.getElementById('intro-view').style.display = 'none';
                        document.getElementById('chat-stream').style.display = 'block';
                        document.getElementById('chat-stream').innerHTML = `<div class="bubble user"><strong>You</strong><br>${d.prompt}</div><div class="bubble ai"><strong>Killer King</strong><br>${d.reply}</div>`;
                    };
                    box.appendChild(card);
                });
            });
        }
    </script>
</body>
</html>
